<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
		<title>进货跟踪</title>
		<link rel="stylesheet" type="text/css" href="../css/api.css" />
		<link rel="stylesheet" type="text/css" href="../css/common.css" />
		<link rel="stylesheet" type="text/css" href="../css/myInventory.css" />
		<!--<link rel="stylesheet" type="text/css" href="../css/inventoryList.css" />-->
		<style>
			.changeColor {
				background-color: #FAFAD2;
			}
			.changeColor em {
				background-color: #FAFAD2;
			}
		</style>
	</head>
	<body>
		<script type="text/template" charset="utf-8"  id='timeSlot_template'>
			{{ if(it){ }}
			{{ var temp = it.type; }}
			{{ var l = parseInt(100/temp.length) + "%"; }}
			{{ for(var i=0; i<temp.length; i++){}}
			<div style="width: {{=l}}; float: left;line-height: 24px;">
			<div name="selectSolt" data-value="{{=i}}" num="{{=it.num}}" type="{{=temp[i].name}}" class="spanSty1">
			{{=temp[i].name}}
			<br />
			<em class="spanEm">
			({{=temp[i].officeHours[0]}}--{{=temp[i].officeHours[1]}})
			</em>
			</div>
			</div>
			{{}}}
			{{}}}
		</script>
		<div class="header" id="header">
			<div class="backIcon" onclick="goBack();"><img src="../image/deliver/icon_back.png" alt="" />
			</div>
			<div class="title" >
				<div>
					<span id="title">进货跟踪</span>
				</div>
			</div>
			<!--<div class="stockbtn" >
			<button id="stockbtn" onclick="excuteManage();">
			库存调整
			</button>
			</div>-->
		</div>
		<div class="divBg" id="divBg">
			<div name ="typeName" onclick="show(1)" class="spanSty" id="sty1">
				<span class="lang">全城外卖</span>
			</div>
			<div  name ="typeName" onclick="show(2)" class="spanSty" id="sty2">
				<span class="lang">甜品饮料</span>
			</div>
			<div   name ="typeName" onclick="show(3)" class="spanSty" id="sty3">
				<span class="lang">生活超市</span>
			</div>
			<div  name ="typeName" onclick="show(4)" class="spanSty" id="sty4">
				<span class="lang">其它服务</span>
			</div>
		</div>
		<div class="timeSlot" id="timeSlot"></div>
		<div class="topInfo" id="topInfo">
			<div class="totalMoney" id="total"></div>
			<!--<div class="totalMoney">
			早餐：<span id="breakfast">0</span>&nbsp;份
			</div>
			<div class="totalMoney">
			午餐：<span id="lunch">0</span>&nbsp;份&nbsp;&nbsp;&nbsp;&nbsp;晚餐：<span id="dinner">0</span>&nbsp;份
			</div>-->
		</div>
		<div id="main"></div>
	</body>
	<script type="text/javascript" src="../script/api.js"></script>
	<script type="text/javascript" src="../script/av.min.js"></script>
	<script type="text/javascript" src="../script/AV_common.js"></script>
	<script type="text/javascript" src="../script/common.js"></script>
	<script type="text/javascript" src="../script/jquery-1.11.1.min.js"></script>
	<script type="text/javascript" src="../script/doT.min.js"></script>
	<script>
		var tmp = new Array();
		apiready = function() {
			api.addEventListener({
				name : 'keyBack'
			}, function(ret, err) {
				goBack();
			});
			loadType().then(function() {
				show(1);
			});
		}
		function goBack() {
			api.closeWin({
			});
		}

		function loadingCafeTaskList(catalog, hoursType) {
			var header = $api.byId('header');
			var topInfo = $api.byId('topInfo');
			var divBg = $api.byId('divBg');
			var timeSlot = $api.byId('timeSlot');
			$api.fixStatusBar(header);
			var headerPos = $api.offset(header);
			var topInfoPos = $api.offset(topInfo);
			var divBgPos = $api.offset(divBg);
			var timeSlotPos = $api.offset(timeSlot);
			var main = $api.byId('main');
			var mainPos = $api.offset(main);
			api.openFrame({
				name : 'cafeTaskList',
				url : '../html/cafeTaskList.html',
				rect : {
					x : 0,
					y : headerPos.h + topInfoPos.h + divBgPos.h + timeSlotPos.h,
					w : 'auto',
					h : 'auto'
				},
				pageParam : {
					catalog : catalog,
					hoursType : hoursType
				},
				bounces : false,
				opaque : true,
				reload : true
			});
		}

		function loadSum(breakfast, lunch, dinner) {
			document.getElementById('breakfast').innerHTML = breakfast;
			document.getElementById('lunch').innerHTML = lunch;
			document.getElementById('dinner').innerHTML = dinner;
		}

		function loadType() {
			var queryDeliver = new AV.Query(DeliveryMan);
			queryDeliver.include("cafeCar");
			queryDeliver.equalTo("owner", AV.User.current());
			return queryDeliver.first().then(function(man) {
				var car = man.get("cafeCar");
				console.log("car>>>>>>>>>>>" + JSON.stringify(car))
				var obj1 = {
					num : 0,
					type : car.get("officeHours")
				}
				tmp.push(obj1);
				var obj2 = {
					num : 1,
					type : car.get("dessert")
				}
				tmp.push(obj2);
				var obj3 = {
					num : 2,
					type : car.get("superMarket")
				}
				tmp.push(obj3);
				var obj4 = {
					num : 3,
					type : car.get("service")
				}
				tmp.push(obj4);
				return AV.Promise.as();
			}).catch(function(error) {
				return AV.Promise.error(error);
			})
		}

		function show(num) {
			var template = document.getElementById("timeSlot_template").innerHTML;
			document.getElementById("timeSlot").innerHTML = doT.template(template)(tmp[Number(num - 1)]);
			$("div[name=selectSolt]").each(function() {
				var start = $(this).attr("data-value");
				if (start == 0) {
					$(this).addClass("changeColor");
					var catalog = $(this).attr("num");
					var hoursType = $(this).attr("type");
					loadingCafeTaskList(catalog, hoursType);
				}
				$(this).click(function() {
					var a = $(this).attr("data-value");
					$("div[name=selectSolt]").each(function() {
						var b = $(this).attr("data-value");
						if (a == b) {
							$(this).addClass("changeColor");
						} else if ($(this).hasClass("changeColor")) {
							$(this).removeClass("changeColor");
						}
					})
					var catalog = $(this).attr("num");
					var hoursType = $(this).attr("type");
					loadingCafeTaskList(catalog, hoursType);
				});
			});
			for (var i = 1; i <= 4; i++) {
				if (i == num) {
					var style = "width: 25%;text-align: center;font-size: 17px;background-color:#FAFAD2"
					document.getElementById("sty" + i).setAttribute("style", style);
				} else {
					var style = "width: 25%;text-align: center;font-size: 17px;background-color:#FFFFFF"
					document.getElementById("sty" + i).setAttribute("style", style);
				}
			}
		}

		function showTotal(type, total) {
			html = type + '：<span>' + total + '</span>&nbsp;份';
			document.getElementById("total").innerHTML = html;
		}

		//		function excuteManage() {
		//			api.execScript({
		//				name : 'myInventory',
		//				frameName : 'inventoryList',
		//				script : 'exceptionEnsure();'
		//			});
		//		}
	</script>
</html>
