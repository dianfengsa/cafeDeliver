<!DOCTYPE HTML>
<html>
	<head>
		<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="content-type" content="text/html" charset="utf-8">
		<link href="../css/reset.css" rel="stylesheet">
		<link rel="stylesheet" href="../css/flex-layout.css">
		<link rel="stylesheet" href="../css/layout.css">
		<link rel="stylesheet" href="../css/index.css">
		<link href="../css/orderDeliveInfo.css" rel="stylesheet">
		<title>我的信息</title>
	</head>
	<body>
		<div class="user-info-web flex-item-24 flex-row">
			<div class="user-info-web-bg flex-item-24 flex-center flex-row">
				<div class="myInfoList">
					<div class="avatar"><img src="../image/textava.png" alt=""></div>
					<span class="Name" id="dName">11111111111</span>
				</div>
			</div>
			<div class="user-info-web-box flex-item-24 flex-center flex-row">
				<div class="flex-item-24 flex-row clearfix ">
					<ul class="clearfix bt">
						<li  class="">
							<i class="list-icon icon-1"></i><span>我的状态</span><span class="list-right"><span  id="deliverSta">在岗</span>
								<div id="div1" class="open1">
									<div id="div2" class="open2"></div>
								</div></span>
						</li>
					</ul>
					<ul class="clearfix bt">
						<li  class="">
							<i class="list-icon icon-3"></i><span>我的电话</span><span class="list-right" id="deliverPhone"></span>
						</li>
					</ul>
					<ul class="clearfix bt">
						<li  class="">
							<i class="list-icon icon-2"></i>我的区域
						</li>
					</ul>
					<ul class="clearfix bt">
						<li  class="">
							<span class="list-right-1" id="deliverDd"></span>
						</li>
					</ul>
				</div>
			</div>
		</div>
			<div class="user-out flex-item-24 flex-center flex-between" id="btnLogOut">
				<button type="button" value="退出登录" class="user-out-button">
					退出登录
				</button>
			</div>
			<script src="../newAppJs/jquery.min.js"></script>
			<script src="../newAppJs/api.js"></script>
			<script src="../newAppJs/av.js"></script>
			<script src="../newAppJs/share.js"></script>
			<script src="../newAppJs/dbSearch.js"></script>
	</body>
</html>
<script>
	/*我的信息页面按钮*/
	var pageParam, deliverManInfo;
	apiready = function() {
		//状态按钮
		var div2 = document.getElementById("div2");
		var div1 = document.getElementById("div1");
		pageParam = api.pageParam;
		deliverManInfo = $api.getStorage("deliverMan");
		console.log("deliverManInfo>>>>" + JSON.stringify(deliverManInfo));
		$("#dName").text(deliverManInfo.name ? deliverManInfo.name : "暂无昵称");
		$("#deliverPhone").text(deliverManInfo.phone);
		$("#deliverDd").text(deliverManInfo.cafeCarName);
		//退出登录
		$("#btnLogOut").on("touchend", ".user-out-button", function () {
			logOut();
		});
		//打电话
		$(".user-info-web-bg").on("touchend", "#deliverPhone", function () {
			var cPhone = $("#deliverPhone").text();
			api.call({
				type: 'tel_prompt',
				number: cPhone
			});
		});

		var touchOff = function () {
			div1.className = (div1.className == "close1") ? "open1" : "close1";
		};
		var touchNo = function () {
			div2.className = (div2.className == "close2") ? "open2" : "close2";
		};

		var status = 0;
		$(".user-info-web").on('touchend', '#div1', function () {
			touchOff();
			touchNo();
			if (status == 0) {
				console.log("0");
				setDeliverManStatus(deliverManInfo.id, 0).then(function (ret) {
					console.log(JSON.stringify(ret));
					api.toast({
						msg: '送餐员下线成功',
						location: 'middle',
						duration: 2000
					});
					$("#deliverSta").text("休息");
					status = 1 ;
				});
			}
			if (status == 1) {
				console.log("1");
				setDeliverManStatus(deliverManInfo.id, 1).then(function (ret) {
					console.log(JSON.stringify(ret));
					api.toast({
						msg: '送餐员上线成功',
						location: 'middle',
						duration: 2000
					});
					$("#deliverSta").text("在岗");

						status = 0;
				});
			}

		});
		//切换配送员状态

		function logOut() {
			api.confirm({
				title: '提示',
				msg: '确定注销登录？',
				buttons: ['取消', '确定']
			}, function (ret, err) {
				if (ret.buttonIndex == 2) {
					AV.User.logOut();
					var currentUser = AV.User.current();
					api.openWin({
						name: 'login',
						url: '../new_login.html',
						opaque: true, // 页面不透明
						bounces: false, // 不允许页面弹动
						reload: true,
						delay: 0
					});
				}
			});
		}
	}
</script>
