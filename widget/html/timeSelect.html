<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
		<title>时间选择</title>
		<link rel="stylesheet" type="text/css" href="../css/api.css" />
		<link rel="stylesheet" type="text/css" href="../css/adv.css" />
	</head>
	<body>
		<div id="wrap"></div>
	</body>
	<script type="text/javascript" src="../script/av.min.js"></script>
	<script type="text/javascript" src="../script/api.js"></script>
	<script type="text/javascript" src="../script/common.js"></script>
	<script type="text/javascript" src="../script/doT.min.js"></script>
	<script>
		var body = $api.dom('body');
		//		var pageParam, menuId;
		apiready = function() {
			api.showProgress({
				title : '获取数据中...',
				modal : true
			});
			times = api.pageParam.times;
			var data = new Array();
			times.forEach(function(time) {
				data.push({
					title : time.name,
					subTitle : time.hours,
					titleLocation : 'center',
					titleSize : 20,
					subTitleLocation : 'center',
					subTitleSize : 16
				});
			});
			intiTimeSelect(data);
			$api.addEvt(body, 'touchend', function(e) {
				if (contains(body, e.target)) {//点击body
					goback();
				}
			});
			api.hideProgress();
		}
		function intiTimeSelect(data) {
			var cellHeight = 60;
			var totalCellHeight = data.length * cellHeight;
			var fHeight = api.frameHeight * 0.15;
			var height = api.frameHeight * 0.7;
			var width = api.frameWidth;
			var obj = api.require('listView');
			obj.open({
				"x" : Math.ceil(width * 0.1),
				"y" : totalCellHeight > height ? Math.ceil(fHeight) : Math.ceil((api.frameHeight - totalCellHeight) / 2),
				"w" : Math.ceil(width * 0.8),
				"h" : totalCellHeight > height ? Math.ceil(height) : totalCellHeight,
				"cellBgColor" : "#FFF",
				"cellSelectColor" : "#f5f5f5",
				"cellHeight" : cellHeight,
				"data" : data
			}, function(ret, err) {
				if (ret.eventType !== "open") {
					api.execScript({
						name : 'businessHours',
//						frameName : 'alterOrNot',
						script : 'alterOrNot("' + data[ret.index].title + '");'
					});
					console.log(JSON.stringify(ret));
					goback();
				}
			});
		}

		var contains = function(parent, el) {
			var mark = false;
			if (el === parent) {
				mark = true;
				return mark;
			} else {
				do {
					el = el.parentNode;
					if (el === parent) {
						mark = true;
						return mark;
					}
				} while (el === document.body || el === document.documentElement);
				return mark;
			}
		}
		function goback() {
			api.unlockSlidPane();
			$api.rmStorage('timeSelect');
			var obj = api.require('listView');
			obj.hide();
			api.closeFrame({
			});
		}
	</script>
</html>
